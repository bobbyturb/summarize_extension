# è°ƒè¯•æŒ‡å— - æŸ¥çœ‹æ’ä»¶æ—¥å¿—

å½“é‡åˆ°é—®é¢˜æ—¶ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—å¯ä»¥å¸®åŠ©å®šä½é—®é¢˜åŸå› ã€‚

## å¦‚ä½•æŸ¥çœ‹ä¸åŒç»„ä»¶çš„æ—¥å¿—

### 1. æŸ¥çœ‹ Background Service Worker æ—¥å¿—ï¼ˆæœ€é‡è¦ï¼‰

**Background Service è´Ÿè´£æ‰€æœ‰ API è°ƒç”¨ï¼Œè¿™æ˜¯æ’æŸ¥é—®é¢˜çš„å…³é”®ã€‚**

**æ–¹æ³•1: é€šè¿‡æ‰©å±•ç®¡ç†é¡µé¢**
1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. æ‰¾åˆ° "AIç¿»è¯‘ä¸æ€»ç»“åŠ©æ‰‹"
4. ç‚¹å‡» "æ£€æŸ¥è§†å›¾" ä¸‹çš„ **"service worker"** é“¾æ¥
5. åœ¨æ‰“å¼€çš„å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ Console æ ‡ç­¾

**æ–¹æ³•2: å¿«é€Ÿè®¿é—®**
- åœ¨æ‰©å±•å›¾æ ‡ä¸Šå³é”® â†’ "æ£€æŸ¥èƒŒæ™¯é¡µ"ï¼ˆæŸäº›ç‰ˆæœ¬çš„Chromeï¼‰

**å…³é”®æ—¥å¿—æ ‡è¯†:**
- `[Test Connection]` - æµ‹è¯•è¿æ¥ç›¸å…³
- `[AI Service]` - AIæœåŠ¡é…ç½®åŠ è½½
- `[OpenAI]` / `[Ollama]` / `[Claude]` / `[Gemini]` - APIè°ƒç”¨è¯¦æƒ…

### 2. æŸ¥çœ‹è®¾ç½®é¡µé¢æ—¥å¿—

**å½“é…ç½®æˆ–æµ‹è¯•è¿æ¥å‡ºé”™æ—¶æŸ¥çœ‹è¿™é‡Œã€‚**

1. æ‰“å¼€è®¾ç½®é¡µé¢ï¼ˆç‚¹å‡»æ’ä»¶å›¾æ ‡ â†’ è®¾ç½®ï¼‰
2. åœ¨è®¾ç½®é¡µé¢ä¸ŠæŒ‰ `F12` æˆ–å³é”® â†’ æ£€æŸ¥
3. æŸ¥çœ‹ Console æ ‡ç­¾

**å…³é”®æ—¥å¿—æ ‡è¯†:**
- `[Options]` - è®¾ç½®é¡µé¢æ“ä½œ

### 3. æŸ¥çœ‹ä¾§è¾¹æ æ—¥å¿—

**å½“ç¿»è¯‘æˆ–æ€»ç»“åŠŸèƒ½å‡ºé”™æ—¶æŸ¥çœ‹ã€‚**

1. æ‰“å¼€ä¾§è¾¹æ ï¼ˆç‚¹å‡»æ’ä»¶å›¾æ ‡ â†’ æ‰“å¼€ä¾§è¾¹æ ï¼‰
2. åœ¨ä¾§è¾¹æ åŒºåŸŸå³é”® â†’ æ£€æŸ¥
3. æŸ¥çœ‹ Console æ ‡ç­¾

### 4. æŸ¥çœ‹ Content Script æ—¥å¿—

**å½“é¡µé¢å†…å®¹æå–å‡ºé”™æ—¶æŸ¥çœ‹ã€‚**

1. æ‰“å¼€ä»»æ„ç½‘é¡µ
2. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åœ¨ Console æ ‡ç­¾ä¸­ç­›é€‰åŒ…å« "AIåŠ©æ‰‹" çš„æ¶ˆæ¯

## å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•

### é”™è¯¯ 1: "è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® XXX API Key"

**åŸå› :** æœªé…ç½®æˆ–æœªä¿å­˜ API Key

**è§£å†³:**
1. æ‰“å¼€è®¾ç½®é¡µé¢
2. é€‰æ‹©å¯¹åº”çš„ AI æœåŠ¡å•†
3. å¡«å†™ API Key
4. ç‚¹å‡»"ä¿å­˜è®¾ç½®"
5. å†æ¬¡ç‚¹å‡»"æµ‹è¯•è¿æ¥"

### é”™è¯¯ 2: "æ— æ³•è¿æ¥åˆ° Ollama æœåŠ¡"

**åŸå› :** Ollama æœåŠ¡æœªå¯åŠ¨æˆ–åœ°å€é…ç½®é”™è¯¯

**è§£å†³:**
1. ç¡®ä¿ Ollama å·²å®‰è£…å¹¶å¯åŠ¨
   ```bash
   ollama serve
   ```
2. æ£€æŸ¥æœåŠ¡åœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤: `http://localhost:11434`ï¼‰
3. ç¡®ä¿å·²ä¸‹è½½æ¨¡å‹
   ```bash
   ollama pull llama2
   ```

**è°ƒè¯•æ­¥éª¤:**
1. åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:11434`ï¼Œåº”è¯¥çœ‹åˆ° "Ollama is running"
2. æ£€æŸ¥ Background Service Worker æ—¥å¿—ï¼ŒæŸ¥çœ‹å…·ä½“çš„é”™è¯¯ä¿¡æ¯

### é”™è¯¯ 3: OpenAI API è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› :**
- API Key é”™è¯¯æˆ–è¿‡æœŸ
- ä½™é¢ä¸è¶³
- ç½‘ç»œé—®é¢˜
- API Base URL é…ç½®é”™è¯¯ï¼ˆä½¿ç”¨ä»£ç†æ—¶ï¼‰

**è°ƒè¯•æ­¥éª¤:**
1. æŸ¥çœ‹ Background Service Worker æ—¥å¿—ä¸­çš„ `[OpenAI]` æ¶ˆæ¯
2. æŸ¥çœ‹å“åº”çŠ¶æ€ç :
   - `401` - API Key é”™è¯¯
   - `429` - è¯·æ±‚è¿‡äºé¢‘ç¹æˆ–ä½™é¢ä¸è¶³
   - `500` - OpenAI æœåŠ¡å™¨é”™è¯¯
3. æ£€æŸ¥ API Key æ˜¯å¦ä»¥ `sk-` å¼€å¤´ï¼ˆæ–°æ ¼å¼å¯èƒ½ä¸åŒï¼‰
4. åœ¨ OpenAI å®˜ç½‘æ£€æŸ¥ä½™é¢: https://platform.openai.com/usage

### é”™è¯¯ 4: "Failed to fetch" æˆ–ç½‘ç»œé”™è¯¯

**å¯èƒ½åŸå› :**
- ç½‘ç»œè¿æ¥é—®é¢˜
- CORS é—®é¢˜
- é˜²ç«å¢™é˜»æ­¢

**è§£å†³:**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å¦‚æœä½¿ç”¨ Ollamaï¼Œç¡®ä¿æœåŠ¡åœ¨æœ¬åœ°è¿è¡Œ
3. å¦‚æœä½¿ç”¨è¿œç¨‹ APIï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦ä»£ç†
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS ç›¸å…³é”™è¯¯

### é”™è¯¯ 5: æ’ä»¶å›¾æ ‡æ˜¾ç¤ºä½†ç‚¹å‡»æ— ååº”

**å¯èƒ½åŸå› :**
- Service Worker å´©æºƒ
- æ‰©å±•æœªæ­£ç¡®åŠ è½½

**è§£å†³:**
1. è®¿é—® `chrome://extensions/`
2. æ‰¾åˆ°æ’ä»¶ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’® ğŸ”„
3. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯æç¤º
4. å¦‚æœè¿˜ä¸è¡Œï¼Œç§»é™¤åé‡æ–°åŠ è½½æ’ä»¶

## æ—¥å¿—è¯¦ç»†è¯´æ˜

### æ­£å¸¸çš„æµ‹è¯•è¿æ¥æ—¥å¿—æµç¨‹

```
[Options] å¼€å§‹æµ‹è¯•è¿æ¥
[Options] å‘é€æµ‹è¯•è¿æ¥æ¶ˆæ¯åˆ° background
[Test Connection] å¼€å§‹æµ‹è¯•è¿æ¥...
[Test Connection] æ­£åœ¨åˆ›å»º AI æœåŠ¡å®ä¾‹...
[AI Service] å¼€å§‹ä»å­˜å‚¨åŠ è½½é…ç½®...
[AI Service] å½“å‰é€‰æ‹©çš„æœåŠ¡å•†: openai
[AI Service] æœåŠ¡é…ç½®: { provider: 'openai', model: 'gpt-3.5-turbo', baseUrl: 'https://api.openai.com/v1', apiKey: 'sk-proj...' }
[AI Service] é…ç½®éªŒè¯é€šè¿‡ï¼Œåˆ›å»ºæœåŠ¡å®ä¾‹
[Test Connection] AI æœåŠ¡å®ä¾‹åˆ›å»ºæˆåŠŸï¼Œå¼€å§‹æµ‹è¯•è¿æ¥...
[OpenAI] è°ƒç”¨ API: { model: 'gpt-3.5-turbo', baseUrl: 'https://api.openai.com/v1' }
[OpenAI] å“åº”çŠ¶æ€: 200
[OpenAI] è°ƒç”¨æˆåŠŸ
[Test Connection] æµ‹è¯•ç»“æœ: { success: true, message: 'Hello' }
[Options] æ”¶åˆ°æµ‹è¯•å“åº”: { success: true, message: 'Hello' }
```

### å¤±è´¥çš„æ—¥å¿—ç¤ºä¾‹

```
[Test Connection] å¼€å§‹æµ‹è¯•è¿æ¥...
[AI Service] å½“å‰é€‰æ‹©çš„æœåŠ¡å•†: openai
[AI Service] æœåŠ¡é…ç½®: { ... }
[OpenAI] è°ƒç”¨ API: { model: 'gpt-3.5-turbo', baseUrl: 'https://api.openai.com/v1' }
[OpenAI] å“åº”çŠ¶æ€: 401
[OpenAI] API é”™è¯¯å“åº”: {"error":{"message":"Incorrect API key provided","type":"invalid_request_error"}}
[OpenAI] è°ƒç”¨å¼‚å¸¸: Error: Incorrect API key provided
[Test Connection] æµ‹è¯•å¤±è´¥: Error: Incorrect API key provided
```

## è·å–å¸®åŠ©

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ä»æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·ï¼š

1. æ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š
   - Chrome ç‰ˆæœ¬
   - ä½¿ç”¨çš„ AI æœåŠ¡å•†
   - Background Service Worker å®Œæ•´æ—¥å¿—
   - é”™è¯¯æˆªå›¾

2. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“ï¼ŒåŒ…å«ä¸Šè¿°ä¿¡æ¯

## å¼€å‘æ¨¡å¼è°ƒè¯•æŠ€å·§

### å¯ç”¨è¯¦ç»†æ—¥å¿—

æ‰€æœ‰æ—¥å¿—å·²ç»å†…ç½®åœ¨ä»£ç ä¸­ï¼Œä»¥ `console.log` å’Œ `console.error` å½¢å¼è¾“å‡ºã€‚

### æ‰‹åŠ¨æµ‹è¯• API

åœ¨ Background Service Worker çš„æ§åˆ¶å°ä¸­ï¼Œå¯ä»¥æ‰‹åŠ¨æµ‹è¯•ï¼š

```javascript
// æµ‹è¯•åŠ è½½é…ç½®
chrome.storage.sync.get(null, (data) => console.log('å½“å‰é…ç½®:', data));

// æ‰‹åŠ¨æµ‹è¯•è¿æ¥
chrome.runtime.sendMessage({action: 'testConnection'}, (response) => {
  console.log('æµ‹è¯•ç»“æœ:', response);
});
```

### æ¸…é™¤é…ç½®é‡æ–°å¼€å§‹

```javascript
// åœ¨ Background Service Worker æ§åˆ¶å°ä¸­æ‰§è¡Œ
chrome.storage.sync.clear(() => {
  console.log('é…ç½®å·²æ¸…é™¤');
});
```

## æ€§èƒ½ç›‘æ§

åœ¨ Background Service Worker æ§åˆ¶å°ä¸­ï¼š

```javascript
// æŸ¥çœ‹å†…å­˜ä½¿ç”¨
console.log('Memory:', performance.memory);

// ç›‘æ§ API è°ƒç”¨æ—¶é—´
console.time('APIè°ƒç”¨');
// ... API è°ƒç”¨ ...
console.timeEnd('APIè°ƒç”¨');
```
